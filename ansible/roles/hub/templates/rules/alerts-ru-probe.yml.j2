groups:
- name: alerts-ru-probe
  rules:
  # WG: низкий uplink (в Mbps)
  - alert: RUWGThroughputLowUplink
    expr: (ru:wg:throughput_uplink_bps / 1e6) < 60
    for: 30m
    labels:
      severity: warning
    annotations:
      summary: |
        {% raw %}Низкая сквозная скорость WG (uplink) — {{ $labels.name }}{% endraw %}

      description: |
        {% raw %}Uplink сейчас {{ printf "%.1f" $value }} Mbps (< 60 Mbps).{% endraw %}

  # WG: низкий downlink (в Mbps)
  - alert: RUWGThroughputLowDownlink
    expr: (ru:wg:throughput_downlink_bps / 1e6) < 60
    for: 30m
    labels:
      severity: warning
    annotations:
      summary: |
        {% raw %}Низкая сквозная скорость WG (downlink) — {{ $labels.name }}{% endraw %}

      description: |
        {% raw %}Downlink сейчас {{ printf "%.1f" $value }} Mbps (< 60 Mbps).{% endraw %}

  # WG-проба не обновлялась (staleness)
  - alert: RUWGProbeStale
    expr: ru:wg:last_run_age_seconds > 10h
    for: 30m
    labels:
      severity: warning
    annotations:
      summary: |
        {% raw %}WG iperf-проба не обновлялась > 10 часов — {{ $labels.name }}{% endraw %}

      description: |
        {% raw %}Текущее отставание: {{ humanizeDuration $value }}.{% endraw %}
